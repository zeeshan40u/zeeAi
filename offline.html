<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Offline Mode - ZeeAi</title>
  <style>
body {
  font-family: Arial, sans-serif;
  background-color: #111;
  color: #eee;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  text-align: center;
  overflow: hidden;

  /* prevent text selection and tap highlight */
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.container {
  max-width: 300px;
  padding: 15px;
}

h1 {
  color: #00ff55;
}

button {
  background-color: #00ff55;
  color: #111;
  border: none;
  padding: 10px 20px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  margin-top: 15px;

  /* prevent selection and highlight */
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

button:hover {
  background-color: #00cc44;
}

.game-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.95);
  display: none;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  z-index: 1000;
}

canvas {
  background: #222;
  border: 2px solid #00ff55;
  border-radius: 12px;
}

.close-btn {
  position: absolute;
  top: 15px;
  right: 15px;
  width: 50px;
  height: 50px;
  font-size: 22px;
  background-color: #111111;
  color: white;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  z-index: 1100;
  display: flex;
  justify-content: center;
  align-items: center;

  /* prevent selection and highlight */
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.close-btn:hover {
  background-color: #cc0000;
}

.score-display {
  color: #0f0;
  margin-top: 10px;
  font-size: 20px;
  font-weight: bold;
}

.game-button {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #00ff55;
  color: #111;
  border: none;
  padding: 12px 24px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  z-index: 999;

  /* prevent selection and highlight */
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}
  </style>
</head>
<body>
  <div class="container" id="backgroundContent">
    <h1>You‚Äôre Offline</h1>
    <p>Please check your internet connection and try again.</p>
    <button onclick="location.reload()">üîÑ Try Again</button>
  </div>

  <button class="game-button" onclick="openGame()">üéÆ Play Game</button>

  <div class="game-overlay" id="gameOverlay">
    <canvas id="racing-canvas" width="320" height="500"></canvas>
    <div id="score" class="score-display">Score: 0</div>
    <div id="high-score" class="score-display">High Score: 0</div>
    <button class="close-btn" onclick="closeGame()">‚ùå</button>
  </div>

<script>
const overlay = document.getElementById("gameOverlay");
const canvas = document.getElementById("racing-canvas");
const ctx = canvas.getContext("2d");

let player, obstacles, score, highScore, gameOver;
let playerSpeed = 4; // horizontal control
let baseGameSpeed = 3; // normal forward speed
let gameSpeed = baseGameSpeed;
let nitroActive = false, nitroDuration = 0, nitroCooldown = 0;

const NITRO_DURATION_FRAMES = 300; // 5 seconds
const NITRO_COOLDOWN_FRAMES = 900; // 15 seconds

let keys = {};
let leftBtn, rightBtn, nitroBtn;

// Pixel Cars
const playerCarDesign = [
  ['T','T','D','D','D','D','T','T'],
  ['T','D','L','L','L','L','D','T'],
  ['D','L','G','G','G','G','L','D'],
  ['D','L','G','G','G','G','L','D'],
  ['T','D','L','L','L','L','D','T']
];
const opponentCarDesign = [
  ['T','T','R','R','R','R','T','T'],
  ['T','R','O','O','O','O','R','T'],
  ['R','O','B','B','B','B','O','R'],
  ['R','O','B','B','B','B','O','R'],
  ['T','R','O','O','O','O','R','T']
];
const colors = {
  'T':'#00000000', 'D':'#444444', 'L':'#CCCCCC', 'G':'#00FF00',
  'R':'#FF0000','O':'#FFAA00','B':'#0000FF'
};

// Draw pixel car
function drawCar(x, y, design, scale = 6){
  for(let row=0; row<design.length; row++){
    for(let col=0; col<design[row].length; col++){
      const color = design[row][col];
      if(color !== 'T'){
        ctx.fillStyle = colors[color] || '#000';
        ctx.fillRect(x + col*scale, y + row*scale, scale, scale);
      }
    }
  }
}

// Open / Close game
function openGame() {
  overlay.style.display = "flex";
  startGame();
}

function closeGame() {
  overlay.style.display = "none";
  gameOver = true;
  removeGameControls();
}

// Start Game
function startGame(){
  const scale = 6;
  player = {
    x: canvas.width/2 - (playerCarDesign[0].length*scale)/2,
    y: canvas.height - playerCarDesign.length*scale - 10,
    width: playerCarDesign[0].length*scale,
    height: playerCarDesign.length*scale
  };

  obstacles = [];
  score = 0;
  highScore = localStorage.getItem("highScore") || 0;
  gameOver = false;
  gameSpeed = baseGameSpeed;
  nitroActive = false;
  nitroDuration = 0;
  nitroCooldown = 0;

  document.getElementById("score").innerText = `Score: ${score}`;
  document.getElementById("high-score").innerText = `High Score: ${highScore}`;

  addGameControls();
  requestAnimationFrame(updateGame);
}

// Spawn Opponent
function spawnObstacle(){
  const scale = 6;
  const width = opponentCarDesign[0].length*scale;
  const height = opponentCarDesign.length*scale;
  const x = Math.random() * (canvas.width - width - 10) + 5;
  obstacles.push({x, y:-height, width, height, passed:false});
}

// Update Game Loop
function updateGame(){
  if(gameOver) return;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Obstacles
  for(let obs of obstacles){
    obs.y += gameSpeed;
    drawCar(obs.x, obs.y, opponentCarDesign);

    if(!obs.passed && obs.y > player.y + player.height){  
      score++; obs.passed = true;  
      document.getElementById("score").innerText = `Score: ${score}`;  

      // Opponent speed increase after score 30
      if(score >= 30 && (score - 30) % 5 === 0){  
        baseGameSpeed += 0.5;  
      }  
    }
  }

  obstacles = obstacles.filter(o => o.y < canvas.height + 20);
  // reduced spawn rate ‚Üí less traffic
  if(Math.random() < 0.015) spawnObstacle();

  // Draw player
  drawCar(player.x, player.y, playerCarDesign);

  // Collision
  for(let obs of obstacles){
    if(player.x < obs.x + obs.width &&
       player.x + player.width > obs.x &&
       player.y < obs.y + obs.height &&
       player.y + player.height > obs.y){
      endGame(); return;
    }
  }

  // Nitro forward speed (horizontal control unaffected)
  if(nitroActive){
    gameSpeed = baseGameSpeed * 1.8; 
    nitroDuration--;
    updateNitroButton();
    if(nitroDuration <= 0){
      nitroActive = false;
      nitroCooldown = NITRO_COOLDOWN_FRAMES;
      gameSpeed = baseGameSpeed;
    }
  } else if(nitroCooldown > 0){
    nitroCooldown--;
    gameSpeed = baseGameSpeed;
    updateNitroButton();
  }

  // Horizontal movement
  if(keys["ArrowLeft"]) player.x = Math.max(player.x - playerSpeed, 0);
  if(keys["ArrowRight"]) player.x = Math.min(player.x + playerSpeed, canvas.width - player.width);

  requestAnimationFrame(updateGame);
}

// End Game
function endGame(){
  gameOver = true;
  removeGameControls();
  ctx.fillStyle = '#0F0';
  ctx.font = '20px Arial';
  ctx.fillText("Game Over!", canvas.width/2-50, canvas.height/2);
  ctx.fillText(`Score: ${score}`, canvas.width/2-40, canvas.height/2+30);
  if(score > highScore){
    highScore = score;
    localStorage.setItem("highScore", highScore);
  }
  document.getElementById("high-score").innerText = `High Score: ${highScore}`;
}

// Controls
document.addEventListener("keydown", e => { keys[e.key] = true; });
document.addEventListener("keyup", e => { keys[e.key] = false; });

// Nitro button
function updateNitroButton(){
  if(!nitroBtn) return;
  const ratio = nitroActive ? nitroDuration/NITRO_DURATION_FRAMES : nitroCooldown/NITRO_COOLDOWN_FRAMES;
  const fill = nitroActive
    ? `linear-gradient(to top, rgba(0,255,0,0.7) ${ratio*100}%, rgba(0,255,0,0.2) 0%)`
    : `linear-gradient(to top, rgba(0,255,0,0.7) ${(1-ratio)*100}%, rgba(0,255,0,0.2) 0%)`;

  nitroBtn.style.backgroundImage = `${fill}, url('NitroAbility_Icon.png')`;
  nitroBtn.style.backgroundSize = "100% 100%, 60% auto";
  nitroBtn.style.backgroundRepeat = "no-repeat";
  nitroBtn.style.backgroundPosition = "center";

  nitroBtn.innerText = "üöÄ";
  nitroBtn.style.fontSize = "28px";
}

// Touch / UI buttons
function addGameControls(){
  const btnStyle = "width:70px; height:70px; font-size:28px; border-radius:50%; z-index:1000; display:flex; align-items:center; justify-content:center;";

  leftBtn = document.createElement("button");
  leftBtn.innerText = "‚¨ÖÔ∏è";
  leftBtn.style.cssText = `position:fixed; bottom:10px; left:10px; ${btnStyle}`;
  leftBtn.addEventListener("touchstart",()=>keys["ArrowLeft"]=true);
  leftBtn.addEventListener("touchend",()=>keys["ArrowLeft"]=false);
  document.body.appendChild(leftBtn);

  rightBtn = document.createElement("button");
  rightBtn.innerText = "‚û°Ô∏è";
  rightBtn.style.cssText = `position:fixed; bottom:10px; left:90px; ${btnStyle}`;
  rightBtn.addEventListener("touchstart",()=>keys["ArrowRight"]=true);
  rightBtn.addEventListener("touchend",()=>keys["ArrowRight"]=false);
  document.body.appendChild(rightBtn);

  nitroBtn = document.createElement("button");
  nitroBtn.innerText = "üöÄ";
  nitroBtn.style.cssText = `position:fixed; bottom:10px; right:10px; ${btnStyle} background-color:#111;`;
  nitroBtn.addEventListener("click",()=>{
    if(!nitroActive && nitroCooldown === 0){
      nitroActive = true;
      nitroDuration = NITRO_DURATION_FRAMES;
      updateNitroButton();
    }
  });
  document.body.appendChild(nitroBtn);
  updateNitroButton();
}

function removeGameControls(){
  if(leftBtn) leftBtn.remove();
  if(rightBtn) rightBtn.remove();
  if(nitroBtn) nitroBtn.remove();
}
</script>
</body>
</html>