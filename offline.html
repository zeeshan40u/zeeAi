<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Offline Mode - ZeeAi</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #eee;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
      overflow: hidden;
    }

    .container {
      max-width: 300px;
      padding: 15px;
    }

    h1 { color: #00ff55; }

    button {
      background-color: #00ff55;
      color: #111;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 15px;
    }

    button:hover { background-color: #00cc44; }

    .game-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.95);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 1000;
    }

    canvas {
      background: #222;
      border: 2px solid #00ff55;
      border-radius: 12px;
    }

    .close-btn {
      margin-top: 20px;
      background-color: #ff4444;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }

    .score-display {
      color: #0f0;
      margin-top: 10px;
      font-size: 20px;
      font-weight: bold;
    }

    .game-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #00ff55;
      color: #111;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      z-index: 999;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>You‚Äôre Offline</h1>
    <p>Please check your internet connection and try again.</p>
    <button onclick="location.reload()">üîÑ Try Again</button>
  </div>

  <button class="game-button" onclick="openGame()">üéÆ Play Game</button>

  <div class="game-overlay" id="gameOverlay">
    <canvas id="racing-canvas" width="320" height="500"></canvas>
    <div id="score" class="score-display">Score: 0</div>
    <div id="high-score" class="score-display">High Score: 0</div>
    <button class="close-btn" onclick="closeGame()">‚ùå Close Game</button>
  </div>
<script>
const overlay = document.getElementById("gameOverlay");
const canvas = document.getElementById("racing-canvas");
const ctx = canvas.getContext("2d");

let player, obstacles, score, highScore, gameOver;
let playerBaseSpeed = 4, playerSpeed = 4;
let nitroActive = false, nitroDuration = 0, nitroCooldown = 0;

const NITRO_DURATION_FRAMES = 180; // 3 sec
const NITRO_COOLDOWN_FRAMES = 540; // 9 sec

let keys = {};
let leftBtn, rightBtn, nitroBtn;

// Load images
const playerCarImg = new Image();
playerCarImg.src = "Player.png";

const opponentCarImg = new Image();
opponentCarImg.src = "opponent.png";

let imagesReady = 0;
[playerCarImg, opponentCarImg].forEach(img => {
  img.onload = () => { imagesReady++; };
  img.onerror = () => console.error("‚ùå Missing image:", img.src);
});

// --- Scale helper ---
function getScaledSize(img, scale = 0.5) {
  return {
    width: img.naturalWidth * scale,
    height: img.naturalHeight * scale
  };
}

function startGame(){
  let pSize = getScaledSize(playerCarImg, 0.5); // 50% size
  player = {
    x: canvas.width/2 - pSize.width/2,
    y: canvas.height - pSize.height - 20,
    width: pSize.width,
    height: pSize.height
  };

  obstacles = [];
  score = 0;
  highScore = localStorage.getItem("highScore") || 0;
  gameOver = false;
  playerSpeed = playerBaseSpeed;
  nitroActive = false;
  nitroDuration = 0;
  nitroCooldown = 0; // fully charged at start

  document.getElementById("score").innerText = `Score: ${score}`;
  document.getElementById("high-score").innerText = `High Score: ${highScore}`;

  addGameControls();
  requestAnimationFrame(updateGame);
}

function spawnObstacle(){
  let oSize = getScaledSize(opponentCarImg, 0.5);
  const x = Math.random() * (canvas.width - oSize.width - 10) + 5;
  obstacles.push({
    x: x, y: -oSize.height,
    width: oSize.width, height: oSize.height,
    passed: false
  });
}

function updateGame(){
  if(gameOver) return;
  if(imagesReady < 2){ requestAnimationFrame(updateGame); return; } // wait until cars loaded

  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Obstacles
  for(let obs of obstacles){
    obs.y += 3;
    ctx.drawImage(opponentCarImg, obs.x, obs.y, obs.width, obs.height);

    if(!obs.passed && obs.y > player.y + player.height){
      score++; obs.passed = true;
      document.getElementById("score").innerText=`Score: ${score}`;
    }
  }
  obstacles = obstacles.filter(o => o.y < canvas.height + 20);
  if(Math.random() < 0.02) spawnObstacle();

  // Player
  ctx.drawImage(playerCarImg, player.x, player.y, player.width, player.height);

  // Collision
  for(let obs of obstacles){
    if(player.x < obs.x + obs.width &&
       player.x + player.width > obs.x &&
       player.y < obs.y + obs.height &&
       player.y + player.height > obs.y){
      endGame(); return;
    }
  }

  // Nitro logic
  if(nitroActive){
    playerSpeed = playerBaseSpeed * 3;
    nitroDuration--;
    updateNitroButton();
    if(nitroDuration <= 0){
      nitroActive = false;
      nitroCooldown = NITRO_COOLDOWN_FRAMES;
      playerSpeed = playerBaseSpeed;
    }
  } else if(nitroCooldown > 0){
    nitroCooldown--;
    playerSpeed = playerBaseSpeed;
    updateNitroButton();
  }

  // Movement
  if(keys["ArrowLeft"]) player.x = Math.max(player.x - playerSpeed, 0);
  if(keys["ArrowRight"]) player.x = Math.min(player.x + playerSpeed, canvas.width - player.width);

  requestAnimationFrame(updateGame);
}

function endGame(){
  gameOver = true;
  removeGameControls();
  ctx.fillStyle = '#0F0';
  ctx.font = '20px Arial';
  ctx.fillText("Game Over!", canvas.width/2-50, canvas.height/2);
  ctx.fillText(`Score: ${score}`, canvas.width/2-40, canvas.height/2+30);
  if(score > highScore){
    highScore = score;
    localStorage.setItem("highScore", highScore);
  }
  document.getElementById("high-score").innerText = `High Score: ${highScore}`;
}

// Keyboard controls
document.addEventListener("keydown", e=>{ keys[e.key]=true; });
document.addEventListener("keyup", e=>{ keys[e.key]=false; });

// Nitro button update
function updateNitroButton(){
  if(!nitroBtn) return;
  let ratio = nitroActive 
    ? nitroDuration/NITRO_DURATION_FRAMES 
    : nitroCooldown/NITRO_COOLDOWN_FRAMES;

  let greenFill = nitroActive 
    ? `linear-gradient(to top, rgba(0,255,0,0.7) ${ratio*100}%, transparent 0%)`
    : `linear-gradient(to top, rgba(0,255,0,0.7) ${(1-ratio)*100}%, transparent 0%)`;

  nitroBtn.style.backgroundImage = `${greenFill}, url('NitroAbility_Icon.png')`;
  nitroBtn.style.backgroundSize = "100% 100%, 70% auto";  // gradient covers full, icon stays visible
  nitroBtn.style.backgroundRepeat = "no-repeat";
  nitroBtn.style.backgroundPosition = "center";
}

// Touch buttons
function addGameControls(){
  // Left
  leftBtn = document.createElement("button");
  leftBtn.innerText = "‚¨ÖÔ∏è";
  leftBtn.style.cssText = "position:fixed; bottom:10px; left:10px; width:70px; height:70px; font-size:28px; border-radius:50%; z-index:1000;";
  leftBtn.addEventListener("touchstart",()=>keys["ArrowLeft"]=true);
  leftBtn.addEventListener("touchend",()=>keys["ArrowLeft"]=false);
  document.body.appendChild(leftBtn);

  // Right
  rightBtn = document.createElement("button");
  rightBtn.innerText = "‚û°Ô∏è";
  rightBtn.style.cssText = "position:fixed; bottom:10px; left:90px; width:70px; height:70px; font-size:28px; border-radius:50%; z-index:1000;";
  rightBtn.addEventListener("touchstart",()=>keys["ArrowRight"]=true);
  rightBtn.addEventListener("touchend",()=>keys["ArrowRight"]=false);
  document.body.appendChild(rightBtn);

  // Nitro
  nitroBtn = document.createElement("button");
  nitroBtn.style.cssText = "position:fixed; bottom:10px; right:10px; width:70px; height:70px; border-radius:50%; background-color:#111; z-index:1000;";
  nitroBtn.addEventListener("click",()=>{
    if(!nitroActive && nitroCooldown === 0){
      nitroActive = true;
      nitroDuration = NITRO_DURATION_FRAMES;
      updateNitroButton();
    }
  });
  document.body.appendChild(nitroBtn);
  updateNitroButton();
}

function removeGameControls(){
  if(leftBtn) leftBtn.remove();
  if(rightBtn) rightBtn.remove();
  if(nitroBtn) nitroBtn.remove();
}
</script>
</body>
</html>